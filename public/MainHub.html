<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCAMSLAM</title>
    <link rel="icon" href="Logo.png" type="image/png">
    <link rel="stylesheet" href="styling1.css">
    <link href="https://fonts.googleapis.com/css2?family=Happy+Monkey&display=swap" rel="stylesheet">

</head>

<body>
    <div class="header">
        <h1>SCAMSLAM</h1>
        <div class="navbar">
            <a href="Homepage.html">Home</a>
            <a href="#home">Get Started</a>
        </div>
    </div>
    <div class="container">
        <script type="module" src="https://unpkg.com/@splinetool/viewer@1.9.89/build/spline-viewer.js"></script>
        <spline-viewer url="https://prod.spline.design/6cqRHpBQma1E79fB/scene.splinecode"></spline-viewer>

    </div>

    <div class="dropdown">
        <button class="dropbtn">Choose your type</button>
        <div class="dropdown-content">
            <ul>
                <li>Email</li>
                <li>Qr code</li>
                <li>URL</li>
            </ul>
        </div>
    </div>
    <form id="container1" style="display:none">
        <input type="text" id="input-box" placeholder="">
        <button id="proceedButton" type="submit">Enter</button>
    </form>
    <br>
    <br>
    <br>
    <div id="result" style="border:0.5 px solid white;background:none;">
        <p></p>
    </div>
    <audio id="alertsound" src="Alert.mp3" preload="auto"></audio>
    </audio>
    <audio id="successound" src="Success.mp3" preload="auto"></audio>
    <script>
        window.onload = function () {
            let selectedType = "";

            // Elements
            const dropbtn = document.querySelector('.dropbtn');
            const dropdownContent = document.querySelector('.dropdown-content');
            const items = document.querySelectorAll('.dropdown-content li');
            const form = document.getElementById('container1');
            const inputBox = document.getElementById('input-box');
            const resultDiv = document.getElementById('result');

            // Toggle dropdown menu on button click
            dropbtn.addEventListener('click', () => {
                dropdownContent.classList.toggle('open');
            });

            // Handle dropdown item selection
            items.forEach(item => {
                item.addEventListener('click', () => {
                    const selection = item.textContent.trim();

                    if (selection === 'Email') {
                        selectedType = 'Email';
                        inputBox.placeholder = 'Enter the email contents you have received';
                    } else if (selection === 'Qr code') {
                        selectedType = 'Qr code';
                        inputBox.placeholder = 'Enter the QR code';
                    } else if (selection === 'URL') {
                        selectedType = 'URL';
                        inputBox.placeholder = 'Enter the URL';
                    }

                    form.style.display = 'flex';
                    dropdownContent.classList.remove('open');
                });
            });

            // Form submit handler
            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                const inputValue = inputBox.value.trim();

                if (!selectedType) {
                    alert("Please select a type first.");
                    return;
                }
                if (!inputValue) {
                    alert("Please enter input.");
                    return;
                }

                // Clear previous result
                resultDiv.textContent = "Processing...";

                try {
                    const response = await fetch('/MainHub/submit', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type: selectedType, input: inputValue }),
                    });

                    if (!response.ok) {
                        throw new Error(`Server responded with status ${response.status}`);
                    }

                    const data = await response.json();

                    // **This is where the result gets displayed**
                    if (data.result) {
                        document.getElementById("result").textContent = data.result;
                        if (data.result.includes("Phishing")) {
                            const alertSound = document.getElementById("alertsound");
                            alertSound.play().catch(e => console.log('Play failed:', e));

                        } else {
                            const successSound = document.getElementById("successound");
                            successSound.play();
                        }
                    } else if (data.error) {
                        document.getElementById("result").textContent = "Error: " + data.error;
                    } else {
                        document.getElementById("result").textContent = "No valid response from server.";
                    }
                } catch (error) {
                    document.getElementById("result").textContent = `Error: Could not connect to server. (${error.message})`;
                }
            });
        };


    </script>
</body>

</html>